"use strict";$(document).ready(function(){var t,a,n=h(),o=v(n),e=!1,c=!1;function s(t){var a;n=h(),o=v(n),a=0!=$("#currentPageNum").val()?$("#currentPageNum").val()>o?o:$("#currentPageNum").val():1,$("#currentPageNum").val(a),$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"paymentHistory",customer_account:t,pageNum:a},success:function(t){"0 results"==t||"No Result"==t?(f("general"),g("general")):(x(t=t.includes("Success")?JSON.parse(t.replace("Success","")):JSON.parse(t),"general"),$(".printBtn").click(function(){var t=$(this).parent().parent().data("id");$("#print_id").val(t),$("#customer_name").val($(this).parent().parent().find(".customer_account").text())}),$(".deleteBtn").click(function(){var t=$(this).parent().parent().data("id"),a=$(this).parent().parent().data("payment-id");$("#delete_data").attr({"data-payment_identifier":t,"data-payment_id":a})}),$(".editBtn").click(function(){y($(this).parent().parent().find(".customer_account").text(),$(this).parent().parent().find(".customer_name").text(),$(this).parent().parent().data("id"),$(this).parent().parent().data("payment-id"),$(this).parent().parent().find(".payment_date").text(),$(this).parent().parent().find(".payment_mode").text(),$(this).parent().parent().find(".payment_salesperson").text(),$(this).parent().parent().find(".payment_remark").text(),$(this).parent().parent().find(".total_payment_amount").text())}))},error:function(t){b("Failed","Unexpected error occur : "+t)}})}function l(a){var t,e;""!=$("#global_search_customer_input").val()?(clearTimeout(t),t=setTimeout(function(){console.log("triggered"),$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowCustomer",searchCustomerName:$("#global_search_customer_input").val(),searchCustomerID:"",pageNum:a},success:function(t){console.log(t),"No result"==t?1==c&&($("#global_search_customer_result").addClass("customer-search-nothing").empty().html('\n                                <div class="sticky-top bg-white">\n                                    <div class="row px-3 py-2">\n                                        <div class="col-6">\n                                            <h5>'.concat(t,'</h5>\n                                        </div>\n                                        <div class="col-6 text-right">\n                                            <a class="btn btn-primary" href="./customerMaintenance.php">Go add new customer</a>\n                                        </div>\n                                    </div>\n                                </div> \n                                ')),c=!1):""==t?($("#customer-search").empty().removeClass("customer-search-nothing").removeClass("border").removeClass("bg-white"),c=!1):(e='\n                            <div class="sticky-top bg-white">\n                                <div class="row px-3 py-2">\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <p class="my-auto">Search Result: <span class="font-weight-bold" id="customerSearchRowTotal"></span></p>\n                                    </div>\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <div class="d-flex flex-row justify-content-end">\n                                            <p class="my-auto">Page : </p>\n                                            <input type="number" id="globalCustomerSearchCurrentPageNum" class="form-control w-25 mx-2 my-auto px-2 pageInput" min="1" value="'.concat(a,'">\n                                            <p class="my-auto"> of <span id="globalCustomerSearchPageTotal"></span></p>\n                                        </div>\n                                    </div>\n                                </div>\n                                <hr class="p-0 m-0">\n                            </div>\n                            <div class="overflow-auto" style="max-height:200px;">\n                            '),$.each(JSON.parse(t),function(t,a){e+='\n                                <a class="global_customer-search-results">\n                                    <div class="view overlay">\n                                        <div class="row px-3 py-2">\n                                            <div class="col-12">\n                                                <h5 class="my-auto customerName">'.concat(a.name,'</h5>\n                                            </div>\n                                            <div class="mask flex-center rgba-grey-slight"> </div>\n                                        </div>\n                                    </div>\n                                </a>\n                                <hr class="p-0 m-0">\n                                ')}),e+="</div>",$("#global_search_customer_result").removeClass("customer-search-nothing").empty().addClass("bg-white").html(e),c=!1,$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowCountCustomer",searchCustomerName:$("#global_search_customer_input").val(),searchCustomerID:""},success:function(t){var a,e;$("#globalCustomerSearchRowTotal").empty().html(t),a=t,e=Math.ceil(a/10),$("#globalCustomerSearchPageTotal").empty().text(e),$("#globalCustomerSearchCurrentPageNum").attr("max",e),$("#globalCustomerSearchCurrentPageNum").on("input",function(){""==$("#globalCustomerSearchCurrentPageNum").val()?console.log("empty customer search"):$("#globalCustomerSearchCurrentPageNum").val()<e?l($("#globalCustomerSearchCurrentPageNum").val()):l(e)})}}),$(".global_customer-search-results").click(function(){$("#global_search_customer_input").val($(this).find(".customerName").text()),$("#global_search_customer_result").empty().removeClass("border"),_()}))}})},1e3)):($("#global_search_customer_result").empty().removeClass("border"),c=!1)}function i(a,e){var t,n;""!=$("#search-customer_name").val()||""!=$("#search-customer_id").val()?(clearTimeout(t),t=setTimeout(function(){console.log("triggered"),$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowCustomer",searchCustomerName:$("#search-customer_name").val(),searchCustomerID:$("#search-customer_id").val(),pageNum:a},success:function(t){"No result"==t?1==e&&($("#customer-search").addClass("customer-search-nothing").empty().html('\n                                <div class="sticky-top bg-white">\n                                    <div class="row px-3 py-2">\n                                        <div class="col-6">\n                                            <h5>'.concat(t,'</h5>\n                                        </div>\n                                        <div class="col-6 text-right">\n                                            <a class="btn btn-primary" href="./customerMaintenance.php">Go add new customer</a>\n                                        </div>\n                                    </div>\n                                </div> \n                                ')),e=!1):""==t?($("#customer-search").empty().removeClass("customer-search-nothing").removeClass("border").removeClass("bg-white"),e=!1):(n='\n                            <div class="sticky-top bg-white">\n                                <div class="row px-3 py-2">\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <p class="my-auto">Search Result: <span class="font-weight-bold" id="customerSearchRowTotal"></span></p>\n                                    </div>\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <div class="d-flex flex-row justify-content-end">\n                                            <p class="my-auto">Page : </p>\n                                            <input type="number" id="customerSearchCurrentPageNum" class="form-control w-25 mx-2 my-auto px-2 pageInput" min="1" value="'.concat(a,'">\n                                            <p class="my-auto"> of <span id="customerSearchPageTotal"></span></p>\n                                        </div>\n                                    </div>\n                                </div>\n                                <hr class="p-0 m-0">\n                            </div>\n                            <div class="overflow-auto" style="max-height:200px;">\n                            '),$.each(JSON.parse(t),function(t,a){n+='\n                                <a class="customer-search-results">\n                                    <div class="view overlay">\n                                        <div class="row px-3 py-2">\n                                            <div class="col-6">\n                                                <h5 class="my-auto customerName">'.concat(a.name,'</h5>\n                                            </div>\n                                            <div class="col-6 text-right">\n                                                <p class="my-auto customerID">').concat(a.customer_account,'</p>\n                                            </div>\n                                            <div class="mask flex-center rgba-grey-slight"> </div>\n                                        </div>\n                                    </div>\n                                </a>\n                                <hr class="p-0 m-0">\n                                ')}),n+="</div>",$("#customer-search").removeClass("customer-search-nothing").empty().addClass("bg-white").html(n),e=!1,$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowCountCustomer",searchCustomerName:$("#search-customer_name").val(),searchCustomerID:$("#search-customer_id").val()},success:function(t){var a,e;$("#customerSearchRowTotal").empty().html(t),a=t,e=Math.ceil(a/10),$("#customerSearchPageTotal").empty().text(e),$("#customerSearchCurrentPageNum").attr("max",e),$("#customerSearchCurrentPageNum").on("input",function(){""==$("#customerSearchCurrentPageNum").val()?console.log("empty customer search"):$("#customerSearchCurrentPageNum").val()<e?i($("#customerSearchCurrentPageNum").val()):i(e)})}}),$(".customer-search-results").click(function(){$("#search-customer_name").val($(this).find(".customerName").text()),$("#search-customer_id").val($(this).find(".customerID").text()),$("#customer-search").empty().removeClass("border"),r($("[name='addModalInvoice']:checked").val())}))}})},1e3)):($("#customer-search").empty().removeClass("border"),e=!1)}function d(){var t="";switch($("[name='addModalInvoice']:checked").val()){case"all-invoice":t="countRowSelectedCustomerInvoiceAll";break;case"outstanding-invoice":t="countRowSelectedCustomerInvoiceOutstanding"}$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:t,customer_account:$("#search-customer_id").val()},success:function(t){var a=Math.ceil(t/20);$("#pageTotalSelectedCustomerInvoiceList").empty().text(a),$("#currentPageNumSelectedCustomerInvoiceList").on("focusout",function(){""==$("#currentPageNumSelectedCustomerInvoiceList").val()?console.log("empty invoice search"):($("#currentPageNumSelectedCustomerInvoiceList").val()<a?console.log("current page num < total page"):($("#currentPageNumSelectedCustomerInvoiceList").val(a),console.log("current page num > total page")),r($("[name='addModalInvoice']:checked").val()))})}})}function r(t){if(""!=$("#search-customer_name").val()){var a=0!=$("#currentPageNumSelectedCustomerInvoiceList").val()?parseInt($("#currentPageNumSelectedCustomerInvoiceList").val())>parseInt($("#pageTotalSelectedCustomerInvoiceList").text())?parseInt($("#pageTotalSelectedCustomerInvoiceList").text()):parseInt($("#currentPageNumSelectedCustomerInvoiceList").val()):1;switch(console.log(a),t){case"all-invoice":$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"viewInvoiceAll",customer_account:$("#search-customer_id").val(),pageNum:a},success:function(t){u(t),d(),console.log("all-invoice",t)},error:function(t){console.log(t)}});break;case"outstanding-invoice":$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"viewInvoiceOutstanding",customer_account:$("#search-customer_id").val(),pageNum:a},success:function(t){u(t),d(),console.log("outstanding-invoice",t)},error:function(t){console.log(t)}})}}}function p(t,a){switch(t){case"all-invoice":$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"viewPaymentUpdateAll",payment_identifier:a},success:function(t){m(t)},error:function(t){console.log(t)}});break;case"outstanding-invoice":$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"viewPaymentUpdateOutstanding",payment_identifier:a},success:function(t){console.log(t),m(t)},error:function(t){console.log(t)}})}}function u(t){var n,o=0;switch(t){case"No result":$("#payment-bucket").empty().html('\n                <tr class="noResultText">\n                    <td colspan="11" class="text-center">\n                        <h5>No payment available</h5>\n                    </td>\n                </tr>\n                ');break;default:$.each(JSON.parse(t),function(t,a){var e=0==a.outstanding?["text-success","paid","disabled='disabled'","checked"]:["text-danger","unpaid","",""];o+=parseFloat(a.outstanding),n+='\n                    <tr class="item-row" data-id="'.concat(a.id,'" data-invoice_id=').concat(a.invoice_id,'>\n                        <td>\n                            <button class="btn btn-danger showInvoiceDetailBtn py-md-3 px-md-4 p-sm-3">\n                                <i class="fas fa-trash-alt"></i>\n                            </button>\n                        </td>\n                        <td class="doc_no-').concat(a.id,'">').concat(a.doc_no,'</td>\n                        <td class="doc_date-').concat(a.id,'">').concat(a.creation_date,'</td>\n                        <td class="invoice_num-').concat(a.id,'">').concat(a.invoice_num,'</td>\n                        <td class="invoice_date-').concat(a.id,'">').concat(a.invoice_date,'</td>\n                        <td class="due_date-').concat(a.id,'">').concat(a.due_date,'</td>\n                        <td class="total_amount-').concat(a.id,'">').concat(a.total_amount,'</td>\n                        <td class="outstanding-').concat(a.id,'">').concat(a.outstanding,'</td>\n                        <td class="payment-').concat(a.id,'">').concat(a.payment,'</td>\n                        <td class="status-').concat(a.id," ").concat(e[0],' text-capitalize font-weight-bold text-center">').concat(e[1],'</td>\n                        <td class="total_price-').concat(a.id,' pay_item text-center">\n                            <input type="checkbox" class="select_to_pay" data-current-payment-made="0" data-previous-outstanding="').concat(a.outstanding,'" data-previous-payment="').concat(a.payment,'" aria-label="').concat(0==a.outstanding?"paid":"unpaid",'" ').concat(e[2]," ").concat(e[3],"/>\n                        </td>\n                    </tr>\n                    ")}),$("#total_outstanding").val(o.toFixed(2)),$("#payment-bucket").empty().html(n)}$(".showInvoiceDetailBtn").click(function(){$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"viewInvoiceDetail",selected_id:$(this).parent().parent().data("invoice_id")},success:function(t){var e,n,o;"No Result"==t?b("Failed","Could not find any invoice results"):(o=n=0,$.each(JSON.parse(t),function(t,a){n+=parseFloat(a.amount),o+=parseFloat(a.discount),e+="\n                            <tr>\n                                <td>".concat(a.item_no,"</td>\n                                <td>").concat(a.description,"</td>\n                                <td>").concat(a.quantity,"</td>\n                                <td>").concat(a.uom,"</td>\n                                <td>").concat(a.price,"</td>\n                                <td>").concat(a.base_cost,"</td>\n                                <td>").concat(a.discount,"</td>\n                                <td>").concat(a.amount,"</td>\n                            </tr>\n                            ")}),$("#item-bucket").empty().html(e),$("#total_discount").empty().text(o.toFixed(2)),$("#total_cost").empty().text(n.toFixed(2)),$("#invoiceDetailModal").modal("show"))}})}),$(".select_to_pay").click(function(){var t=$(this).parent().parent().data("id");if(!(0<parseFloat($("#total_payment").val())))return b("Failed","Total Payment currently is 0. Please add some credit in total payment to pay"),!1;if(0<parseFloat($("#unapply_amount").val())){1==$(this).prop("checked")?(e=parseFloat($("#unapply_amount").val()),n=parseFloat($("#total_outstanding").val()),o=parseFloat($("#total_pay").val()),c=parseFloat($(".outstanding-".concat(t)).text()),s=parseFloat($(".payment-".concat(t)).text()),l=e<c?c-e:c-c,i=e<c?s+e:s+c,d=e<c?e-e:e-c,r=e<c?n-e:n-c,p=e<c?o+e:o+c,a=e<c?e:c,$(this).attr("data-current-payment-made",a)):(e=parseFloat($("#unapply_amount").val()),n=parseFloat($("#total_outstanding").val()),o=parseFloat($("#total_pay").val()),c=parseFloat($(".outstanding-".concat(t)).text()),s=parseFloat($(".payment-".concat(t)).text()),l=c+(a=parseFloat($(this).data("current-payment-made"))),i=s-a,d=e+a,r=n+a,p=o-a,$(this).attr("data-current-payment-made",0)),$(".outstanding-".concat(t)).empty().text(l.toFixed(2)),$(".payment-".concat(t)).empty().text(i.toFixed(2)),$("#total_pay").val(p.toFixed(2)),$("#unapply_amount").val(d.toFixed(2)),$("#total_outstanding").val(r.toFixed(2))}else{if(1==$(this).prop("checked"))return b("Failed","Unapply amount currently is 0. Please add some credit in total payment to pay"),!1;var a,e=parseFloat($("#unapply_amount").val()),n=parseFloat($("#total_outstanding").val()),o=parseFloat($("#total_pay").val()),c=parseFloat($(".outstanding-".concat(t)).text()),s=parseFloat($(".payment-".concat(t)).text()),l=c+(a=parseFloat($(this).data("current-payment-made"))),i=s-a,d=e+a,r=n+a,p=o-a;$(this).attr("data-current-payment-made",0),$(".outstanding-".concat(t)).empty().text(l.toFixed(2)),$(".payment-".concat(t)).empty().text(i.toFixed(2)),$("#total_pay").val(p.toFixed(2)),$("#unapply_amount").val(d.toFixed(2)),$("#total_outstanding").val(r.toFixed(2))}0<parseFloat($(".outstanding-".concat(t)).text())?$(".status-".concat(t)).removeClass("text-success").addClass("text-danger").empty().text("unpaid"):$(".status-".concat(t)).removeClass("text-danger").addClass("text-success").empty().text("paid"),0==parseFloat($("#total_pay").val())?$("#addPaymentSubmitBtn").prop("disabled",!0):$("#addPaymentSubmitBtn").prop("disabled",!1)}),$("#search-customer_id,#search-customer_name").on("keyup",function(){""==$("#search-customer_id").val()&&""==$("#search-customer_name").val()&&$("#payment-bucket").empty().html('                           \n                <tr class="noResultText">\n                    <td colspan="11" class="text-center">\n                        <h5>No payment available</h5>\n                    </td>\n                </tr>')}),$("#total_payment").on("focusout",function(){var c;0<parseFloat($("#total_pay").val())&&(c=0,$("#total_pay").val("0.00"),$.each($(".item-row"),function(t,a){var e,n,o;"unpaid"===$(".select_to_pay:eq(".concat(t,")")).attr("aria-label")&&(e=$(".item-row:eq(".concat(t,")")).data("id"),n=parseFloat($(".select_to_pay:eq(".concat(t,")")).data("previous-payment")),o=parseFloat($(".select_to_pay:eq(".concat(t,")")).data("previous-outstanding")),c+=o,$(".outstanding-".concat(e)).empty().text(o.toFixed(2)),$(".payment-".concat(e)).empty().text(n.toFixed(2)),$(".status-".concat(e)).removeClass("text-success").addClass("text-danger").empty().text("unpaid"),$(".select_to_pay:eq(".concat(t,")")).prop("checked",!1))}),$("#total_outstanding").val(c.toFixed(2)))})}function m(t){var e,n=0;switch(t){case"No result":$("#update-payment-bucket").empty().html('\n                <tr class="noResultText">\n                    <td colspan="11" class="text-center">\n                        <h5>No payment available</h5>\n                    </td>\n                </tr>\n                ');break;default:$.each(JSON.parse(t),function(t,a){n+=parseFloat(a.outstanding),e+='\n                            <tr class="update-item-row" data-id="'.concat(a.id,'" data-invoice_id=').concat(a.invoice_id,'>\n                                <td>\n                                    <button class="btn btn-danger showInvoiceDetailBtn py-md-3 px-md-4 p-sm-3">\n                                        <i class="fas fa-file-invoice"></i>\n                                    </button>\n                                </td>\n                                <td class="update-doc_no-').concat(a.id,'">').concat(a.doc_no,'</td>\n                                <td class="update-doc_date-').concat(a.id,'">').concat(a.creation_date,'</td>\n                                <td class="update-invoice_num-').concat(a.id,'">').concat(a.invoice_num,'</td>\n                                <td class="update-invoice_date-').concat(a.id,'">').concat(a.invoice_date,'</td>\n                                <td class="update-due_date-').concat(a.id,'">').concat(a.due_date,'</td>\n                                <td class="update-total_amount-').concat(a.id,'">').concat(parseFloat(a.total_amount).toFixed(2),'</td>\n                                <td class="update-outstanding update-outstanding-').concat(a.id,'" data-original-outstanding="').concat(a.outstanding,'">').concat(parseFloat(a.outstanding).toFixed(2),'</td>\n                                <td class="update-payment-').concat(a.id,'">\n                                    <div class="input-group md-form form-sm form-2 pl-0">\n                                        <input value="').concat(parseFloat(a.payment).toFixed(2),'" data-original-payment="').concat(a.payment,'" class="form-control update_payment_per_invoice update-payment-amount-').concat(a.id,'" type="number" min="0" step="0.01"/>\n                                        <div class="input-group-append">\n                                            <button data-original-payment="').concat(a.payment,'" data-new-payment="0.00" class="pageInput input-group-text update_payment_refresh update_payment_refresh-').concat(a.id,'">\n                                                <i class="fas fa-sync-alt" aria-hidden="true"></i>\n                                            </button>\n                                        </div>\n                                    </div>\n                                </td>\n                            </tr>\n                            ')}),$("#update-total_outstanding").val(n.toFixed(2)),$("#update-payment-bucket").empty().html(e)}$(".update_payment_per_invoice").on("focusout",function(){var t=parseFloat($(this).val()),a=$(this).parent().parent().parent().data("id"),e=parseFloat($(".update-total_amount-".concat(a)).text()),n=parseFloat($(".update-outstanding-".concat(a)).text()),o=parseFloat($(this).data("original-payment")),c=0,s=0;e<t?$(this).val(e.toFixed(2)):t<0?$(this).val("0.00"):$(this).val(t.toFixed(2)),$(".update-outstanding-".concat(a)).text((n-(t-o)).toFixed(2)),$(".update_payment_refresh-".concat(a)).attr("data-new-payment",t),$.each($(".update-item-row"),function(t,a){c+=parseFloat($(".update-outstanding:eq(".concat(t,")")).text()),s+=parseFloat($(".update_payment_per_invoice:eq(".concat(t,")")).val())}),$("#update-total_outstanding").val(c.toFixed(2)),$("#update-total_pay").val(s.toFixed(2))}),$(".update_payment_refresh").click(function(){var e=0,n=0,t=$(this).parent().parent().parent().parent().data("id"),a=parseFloat($(".update-outstanding-".concat(t)).data("original-outstanding")),o=parseFloat($(this).data("original-payment"));console.log(a),$(".update-outstanding-".concat(t)).text(a.toFixed(2)),$(".update-payment-amount-".concat(t)).val(o.toFixed(2)),$.each($(".update-item-row"),function(t,a){e+=parseFloat($(".update-outstanding:eq(".concat(t,")")).text()),n+=parseFloat($(".update_payment_per_invoice:eq(".concat(t,")")).val())}),$("#update-total_outstanding").val(e.toFixed(2)),$("#update-total_pay").val(n.toFixed(2))}),$(".showInvoiceDetailBtn").click(function(){$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"viewInvoiceHeader",selected_id:$(this).parent().parent().data("invoice_id")},success:function(t){"No Result"==t||$.each(JSON.parse(t),function(t,a){$("#detail-invoice_id").text(a.invoice_id),$("#detail-in_account").text(a.in_account),$("#detail-in_name").text(a.in_name),$("#detail-invoice_num").text(a.invoice_num),$("#detail-invoice_date").text(a.invoice_date),$("#detail-invoice_date").text(a.invoice_date),$("#detail-invoice_remark").text(a.invoice_remark),$("#detail-doc_no").text(a.doc_no),$("#detail-due_date").text(a.due_date),$("#detail-subtotal_ex").text(a.subtotal_ex),$("#detail-discount_header").text(a.discount_header),$("#detail-total_amount").text(a.total_amount)})}}),$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"viewInvoiceDetail",selected_id:$(this).parent().parent().data("invoice_id")},success:function(t){var e,n,o;"No Result"==t?b("Failed","Could not find any invoice results"):(o=n=0,$.each(JSON.parse(t),function(t,a){n+=parseFloat(a.amount),o+=parseFloat(a.discount),e+="\n                                    <tr>\n                                        <td>".concat(a.item_no,"</td>\n                                        <td>").concat(a.description,"</td>\n                                        <td>").concat(a.quantity,"</td>\n                                        <td>").concat(a.uom,"</td>\n                                        <td>").concat(a.price,"</td>\n                                        <td>").concat(a.base_cost,"</td>\n                                        <td>").concat(a.discount,"</td>\n                                        <td>").concat(a.amount,"</td>\n                                    </tr>\n                                    ")}),$("#item-bucket").empty().html(e),$("#total_discount").empty().text(o.toFixed(2)),$("#total_cost").empty().text(n.toFixed(2)),$("#invoiceDetailModal").modal("show"))}})}),$("#update-total_payment").on("focusout",function(){var c;0<parseFloat($("#update-total_pay").val())&&(c=0,$("#update-total_pay").val($("#update-total_pay").data("original-payment-made")),$.each($(".update-item-row"),function(t,a){var e,n,o;"unpaid"===$(".update-select_to_pay:eq(".concat(t,")")).attr("aria-label")&&(e=$(".update-item-row:eq(".concat(t,")")).data("id"),n=parseFloat($(".update-select_to_pay:eq(".concat(t,")")).data("previous-payment")),o=parseFloat($(".update-select_to_pay:eq(".concat(t,")")).data("previous-outstanding")),c+=o,$(".update-outstanding-".concat(e)).empty().text(o.toFixed(2)),$(".update-payment-".concat(e)).empty().text(n.toFixed(2)),$(".update-status-".concat(e)).removeClass("text-success").addClass("text-danger").empty().text("unpaid"),$(".update-select_to_pay:eq(".concat(t,")")).prop("checked",!1))}),$("#update-total_outstanding").val(c.toFixed(2)))})}function y(t,a,e,n,o,c,s,l,i){$("#update-search-customer_name").val(a),$("#update-search-customer_id").val(t),$("#update_identifier_id").val(e),$("#update_payment_id").val(n),$("#update-payment_date").val(o),$("#update-payment_remark").val(l),$("#update-payment_salesperson").val(s),$("#update-payment_mode").val(c),$("#update-total_pay").val(i).attr("data-original-payment-made",i),p("all-invoice",e)}function h(){var a;return $.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"countRow"},async:!1,success:function(t){$("#rowTotal").empty().append(t),a=t}}),a}function v(t){var a=Math.ceil(t/20);return $("#pageTotal").empty().text(a),$("#currentPageNum").val()>a&&$("#currentPageNum").val(a),a}function _(){n=h(),o=v(n);var t=1,a="",e="",t=0!=$("#currentPageNum").val()?$("#currentPageNum").val()>o?o:$("#currentPageNum").val():1;$("#currentPageNum").val(t),""!=$("#global_search_customer_input").val()?(a="viewPaymentHeaderByCustomer",e=$("#global_search_customer_input").val()):(a="viewPaymentHeader",customer_account=""),console.log(a),console.log(e),$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:a,customer_account:e,pageNum:t},success:function(t){console.log(t),"0 results"==t||"No Result"==t||"no customer found"==t?(f("general"),g("general")):(x(t=t.includes("Success")?JSON.parse(t.replace("Success","")):JSON.parse(t),"general"),$(".printBtn").click(function(){var t=$(this).parent().parent().data("id");$("#print_id").val(t),$("#customer_name").val($(this).parent().parent().find(".customer_account").text())}),$(".deleteBtn").click(function(){var t=$(this).parent().parent().data("id"),a=$(this).parent().parent().data("payment-id");$("#delete_data").attr({"data-payment_identifier":t,"data-payment_id":a})}),$(".editBtn").click(function(){y($(this).parent().parent().find(".customer_account").text(),$(this).parent().parent().find(".customer_name").text(),$(this).parent().parent().data("id"),$(this).parent().parent().data("payment-id"),$(this).parent().parent().find(".payment_date").text(),$(this).parent().parent().find(".payment_mode").text(),$(this).parent().parent().find(".payment_salesperson").text(),$(this).parent().parent().find(".payment_remark").text(),$(this).parent().parent().find(".total_payment_amount").text())}))},error:function(t){b("Failed","Unexpected error occur : "+t)}})}function g(t){switch(t){case"general":$("#generalTable").DataTable({searching:!1,paginate:!1,lengthChange:!1,info:!1,scrollX:!0,scrollY:"1000px",scrollCollapse:!0}).columns.adjust();$(".dataTables_length").addClass("bs-select")}}function f(t){switch(t){case"general":$("#general-table").empty().append('<table id="generalTable" class="table table-hover table-bordered table_fullwidth text-center" cellspacing="0" >  <thead class="grey lighten-2  ">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Payment Identifier</th>  <th scope="col" class="th-lg">Customer Account</th>  <th scope="col" class="th-lg">Customer Name</th>  <th scope="col" class="th-lg">Payment Date</th>  <th scope="col" class="th-lg">Payment Mode</th>  <th scope="col" class="th-lg">Payment Sales Person</th>  <th scope="col" class="th-lg">Payment Remark</th>  <th scope="col" class="th-lg">Total Payment Amount</th>  </tr>  </thead>  <tbody id="generalContent">  </tbody>  <tfoot class="grey lighten-2">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Payment Identifier</th>  <th scope="col" class="th-lg">Customer Account</th>  <th scope="col" class="th-lg">Customer Name</th>  <th scope="col" class="th-lg">Payment Date</th>  <th scope="col" class="th-lg">Payment Mode</th>  <th scope="col" class="th-lg">Payment Sales Person</th>  <th scope="col" class="th-lg">Payment Remark</th>  <th scope="col" class="th-lg">Total Payment Amount</th>  </tr>  </tfoot>  </table>')}}function x(t,a){switch(a){case"general":f("general"),$.each(t,function(t,a){$("#generalContent").append('\n                        <tr class="payment_row" data-payment-id="'.concat(a.payment_id,'" data-id="').concat(a.payment_identifier,'">\n                            <th>').concat(++t,'</th>\n                            <td>\n                                <button class="btn btn-warning editBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#editModal">\n                                    <i class="fas fa-edit"></i>\n                                </button>\n                                <button class="btn btn-danger deleteBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#deleteModal">\n                                    <i class="fas fa-trash-alt"></i>\n                                </button>\n                                <button class="btn btn-secondary printBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#printModal">\n                                    <i class="fas fa-print"></i>\n                                </button>\n                            </td>\n                            <td class="payment_identifier">').concat(a.payment_identifier,'</td>\n                            <td class="customer_account">').concat(a.customer_account,'</td>\n                            <td class="customer_name">').concat(a.customer_name,'</td>\n                            <td class="payment_date">').concat(a.payment_date,'</td>\n                            <td class="payment_mode">').concat(a.payment_mode,'</td>\n                            <td class="payment_salesperson">').concat(a.payment_salesperson,'</td>\n                            <td class="payment_remark">').concat(a.payment_remark,'</td>\n                            <td class="total_payment_amount">').concat(a.total_payment_amount,"</td>\n                        </tr>\n                    "))}),g("general")}}function b(t,a){$("#failedToModal").modal("show"),$("#failedModalHeadline").empty().append(t),$("#failedModalBody").empty().append(a)}function F(t,a){$("#successModalHeadline").empty().append(t),$("#successModalBody").empty().append(a),$("#successToModal").modal("show")}_(),$("#total_payment").on("keyup",function(){$("#unapply_amount").val($(this).val())}),$("#total_payment").on("focusout",function(){var t=$("#unapply_amount").val(),a=$(this).val();""==$(this).val()?($("#unapply_amount").val(0),$(this).val(0)):($("#unapply_amount").val(parseFloat(t).toFixed(2)),$(this).val(parseFloat(a).toFixed(2)))}),$("#update-total_payment").on("keyup",function(){$("#update-unapply_amount").val($(this).val())}),$("#update-total_payment").on("focusout",function(){var t=$("#update-unapply_amount").val(),a=$(this).val();""==$(this).val()?($("#update-unapply_amount").val(0),$(this).val(0)):($("#update-unapply_amount").val(parseFloat(t).toFixed(2)),$(this).val(parseFloat(a).toFixed(2)))}),$("#currentPageNum").focusout(function(){"none"==$("#current_customer_view_text").css("display")?(h(),_()):($.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"countRowSelectedCustomer",customer_account:$("#curent_customer_payment_history").data("customer-name")},async:!1,success:function(t){$("#rowTotal").empty().append(t),0}}),s($("#curent_customer_payment_history").data("customer-name")))}),$("#global_search_customer_input").on("keyup",function(){clearTimeout(a),c||($("#global_search_customer_result").empty().removeClass("bg-white").addClass("border").html('\n            <div class="d-flex justify-content-center bg-white border search-result-spinner">\n                <div class="spinner-border" role="status">\n                    <span class="sr-only">Loading...</span>\n                </div>\n            </div>\n            '),c=!0),$(this).val()?a=setTimeout(function(){l(1)},1e3):(_(),$("#global_search_customer_result").empty().removeClass("border"),c=!1)}),$("#search-customer_name, #search-customer_id").on("keyup",function(){clearTimeout(t),e||($("#customer-search").empty().removeClass("bg-white").addClass("border").html('\n            <div class="d-flex justify-content-center bg-white border search-result-spinner">\n                <div class="spinner-border" role="status">\n                    <span class="sr-only">Loading...</span>\n                </div>\n            </div>\n            '),e=!0),$(this).val()?t=setTimeout(function(){i(1)},1e3):($("#customer-search").empty().removeClass("border"),e=!1)}),$("#addModalBtn").click(function(){$("#search-customer_name").val(""),$("#search-customer_id").val(""),$("#customer-search").removeClass("border").empty(),$("#total_payment").val("0.00"),$("#payment_mode").val(""),$("#payment_date").val(""),$("#payment_salesperson").val(""),$("#payment_remark").val(""),$("#unapply_amount").val("0.00"),$("#total_outstanding").val("0.00"),$("#total_pay").val("0.00"),$("#currentPageNumSelectedCustomerInvoiceList").val(1),$("#payment-bucket").empty().html('\n        <tr class="noResultText">\n            <td colspan="11" class="text-center">\n                <h5>No payment available</h5>\n            </td>\n        </tr>\n        ')}),$(".editBtn").click(function(){$("#update-search-customer_name").val(""),$("#update-search-customer_id").val(""),$("#update-customer-search").removeClass("border").empty(),$("#update-total_payment").val("0.00"),$("#update-payment_mode").val(""),$("#update-payment_date").val(""),$("#update-payment_salesperson").val(""),$("#update-payment_remark").val(""),$("#update-unapply_amount").val("0.00"),$("#update-total_outstanding").val("0.00"),$("#update-total_pay").val("0.00"),$("#update-payment-bucket").empty().html('\n        <tr class="noResultText">\n            <td colspan="11" class="text-center">\n                <h5>No payment available</h5>\n            </td>\n        </tr>\n        ')}),$("[name='addModalInvoice']").click(function(){r($("[name='addModalInvoice']:checked").val())}),$("[name='updateModalInvoice']").click(function(){p($("[name='updateModalInvoice']:checked").val())}),$("#addPaymentSubmitBtn").click(function(){var n,o,c,s,l,i,t,a,e,d,r,p,u;n=[],o=[],c=[],s=[],l=[],i=[],u=p=r=d=e=a=t="",0<$("#payment-bucket").find(".noResultText").length?b("Failed","No invoice found"):($.each($(".item-row"),function(t,a){var e=$(".item-row:nth-child(".concat(t+1,")")).data("id");1==$(".select_to_pay:eq(".concat(t,")")).prop("checked")&&0<$(".select_to_pay:eq(".concat(t,")")).data("current-payment-made")&&(n.push(e),o.push($(".item-row:nth-child(".concat(t+1,")")).data("invoice_id")),c.push(parseFloat($(".total_amount-".concat(e)).text())),s.push(parseFloat($(".outstanding-".concat(e)).text())),l.push(parseFloat($(".payment-".concat(e)).text())),i.push($(".status-".concat(e)).text()))}),t=$("#payment_mode").val(),a=$("#payment_remark").val(),e=$("#payment_date").val(),d=$("#payment_salesperson").val(),r=$("#total_pay").val(),p=$("#search-customer_id").val(),u=$("#search-customer_name").val(),$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"pay",id:n,invoice_id:o,total_amount:c,outstanding:s,payment:l,payment_status:i,payment_mode:t,payment_date:e,payment_remark:a,payment_salesperson:d,total_payment_amount:r,customer_account:p,customer_name:u},success:function(t){switch(t){case"success pay":$("#addModal").modal("hide"),F("Success","Payment is successfully added"),$(".btnSuccess").click(function(){location.reload()});break;case"Some input field is not set.":b("Failed",t)}}}))}),$("#updatePaymentSubmitBtn").click(function(){var n,o,c,s,l,t,a,e,i,d,r,p,u,m;n=[],o=[],c=[],s=[],l=[],m=u=p=r=d=i=e=a=t="",0<$("#update-payment-bucket").find(".noResultText").length?b("Failed","No invoice found"):($.each($(".update-item-row"),function(t,a){var e=$(".update-item-row:eq(".concat(t,")")).data("id");n.push(e),o.push($(".update-item-row:nth-child(".concat(t+1,")")).data("invoice_id")),c.push(parseFloat($(".update-total_amount-".concat(e)).text())),s.push(parseFloat($(".update-outstanding-".concat(e)).text())),l.push(parseFloat($(".update-payment-".concat(e)).find(".update_payment_per_invoice").val()))}),e=$("#update-payment_mode").val(),i=$("#update-payment_remark").val(),d=$("#update-payment_date").val(),r=$("#update-payment_salesperson").val(),a=$("#update_identifier_id").val(),t=$("#update_payment_id").val(),u=$("#update-search-customer_id").val(),m=$("#update-search-customer_name").val(),p=$("#update-total_pay").val(),$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"updatePayment",id:n,invoice_id:o,payment_mode:e,total_amount:c,outstanding:s,payment:l,payment_identifier:a,payment_id:t,payment_status:[],payment_date:d,payment_remark:i,payment_salesperson:r,customer_account:u,customer_name:m,total_payment_amount:p},success:function(t){switch(console.log(t),t){case"success update payment":$("#editModal").modal("hide"),F("Success","Payment is successfully updated"),$(".btnSuccess").click(function(){location.reload()});break;case"Some input field is not set.":b("Failed",t)}}}))}),$("#deletePaymentSubmitBtn").click(function(){var t,a;t=$("#delete_data").data("payment_identifier"),a=$("#delete_data").data("payment_id"),$.ajax({type:"POST",url:"./backend/payment/payment.php",data:{postType:"deletePayment",payment_identifier:t,payment_id:a},success:function(t){switch(t){case"success delete payment":$("#deleteModal").modal("hide"),F("Success","Payment is successfully deleted"),$(".btnSuccess").click(function(){location.reload()});break;case"Some input field is not set.":b("Failed",t)}}})}),$(".customer_item").click(function(){var t=$(this).data("customer-name");""!=t&&("none"==t?(_(),$("#curent_customer_payment_history").text(""),$("#curent_customer_payment_history").attr("data-customer-name","none"),$("#current_customer_view_text").hide()):(s(t),$("#curent_customer_payment_history").text($(this).text()),$("#curent_customer_payment_history").attr("data-customer-name",t),$("#current_customer_view_text").show()))})});