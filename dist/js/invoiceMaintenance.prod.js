"use strict";$(document).ready(function(){var s=r(),a=d(s);function c(e){var t,s,a;""!=$("#search-customer_name").val()||""!=$("#search-customer_id").val()?(clearTimeout(t),$("#customer-search").empty().addClass("border").html('\n            <div class="d-flex justify-content-center">\n                <div class="spinner-border" role="status">\n                    <span class="sr-only">Loading...</span>\n                </div>\n            </div>\n            '),s=!0,t=setTimeout(function(){$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowCustomer",searchCustomerName:$("#search-customer_name").val(),searchCustomerID:$("#search-customer_id").val(),pageNum:e},success:function(t){"No result"==t?1==s&&($("#customer-search").empty().html("<h5>".concat(t,"</h5>")),s=!1):""==t?($("#customer-search").empty().removeClass("border"),s=!1):(a='\n                            <div class="sticky-top bg-white">\n                                <div class="row px-3 py-2">\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <p class="my-auto">Search Result: <span class="font-weight-bold" id="customerSearchRowTotal"></span></p>\n                                    </div>\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <div class="d-flex flex-row justify-content-end">\n                                            <p class="my-auto">Page : </p>\n                                            <input type="number" id="customerSearchCurrentPageNum" class="form-control w-25 mx-2 my-auto px-2 pageInput" min="1" value="'.concat(e,'">\n                                            <p class="my-auto"> of <span id="customerSearchPageTotal"></span></p>\n                                        </div>\n                                    </div>\n                                </div>\n                                <hr class="p-0 m-0">\n                            </div>\n                            <div class="overflow-auto" style="max-height:200px;">\n                            '),$.each(JSON.parse(t),function(t,e){a+='\n                                <a class="customer-search-results">\n                                    <div class="view overlay">\n                                        <div class="row px-3 py-2">\n                                            <div class="col-6">\n                                                <h5 class="my-auto customerName">'.concat(e.name,'</h5>\n                                            </div>\n                                            <div class="col-6 text-right">\n                                                <p class="my-auto customerID">').concat(e.customer_account,'</p>\n                                            </div>\n                                            <div class="mask flex-center rgba-grey-slight"> </div>\n                                        </div>\n                                    </div>\n                                </a>\n                                <hr class="p-0 m-0">\n                                ')}),a+="</div>",$("#customer-search").empty().html(a),s=!1,$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowCountCustomer",searchCustomerName:$("#search-customer_name").val(),searchCustomerID:$("#search-customer_id").val()},success:function(t){var e,s;$("#customerSearchRowTotal").empty().html(t),e=t,s=Math.ceil(e/10),$("#customerSearchPageTotal").empty().text(s),$("#customerSearchCurrentPageNum").attr("max",s),$("#customerSearchCurrentPageNum").on("focusout",function(){$("#customerSearchCurrentPageNum").val()<s?c($("#customerSearchCurrentPageNum").val()):c(s)})}}),$(".customer-search-results").click(function(){$("#search-customer_name").val($(this).find(".customerName").text()),$("#search-customer_id").val($(this).find(".customerID").text()),$("#customer-search").empty().removeClass("border")}))}})},1e3)):($("#customer-search").empty().removeClass("border"),s=!1)}function o(e){var t,s,a;""!=$("#search-item").val()?(clearTimeout(t),$("#item-search").empty().addClass("border").html('\n            <div class="d-flex justify-content-center">\n                <div class="spinner-border" role="status">\n                    <span class="sr-only">Loading...</span>\n                </div>\n            </div>\n            '),s=!0,t=setTimeout(function(){$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowItem",search:$("#search-item").val(),pageNum:e},success:function(t){"No result"==t?1==s&&($("#item-search").empty().html("<h5>".concat(t,"</h5>")),s=!1):""==t?($("#item-search").empty().removeClass("border"),s=!1):(a='\n                            <div class="sticky-top bg-white">\n                                <div class="row px-3 py-2 ">\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <p class="my-auto">Search Result: <span class="font-weight-bold" id="itemSearchRowTotal"></span></p>\n                                    </div>\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <div class="d-flex flex-row justify-content-end">\n                                            <p class="my-auto">Page : </p>\n                                            <input type="number" id="itemSearchCurrentPageNum" class="form-control w-25 mx-2 my-auto px-2 pageInput" min="1" value="'.concat(e,'">\n                                            <p class="my-auto"> of <span id="itemSearchPageTotal"></span></p>\n                                        </div>\n                                    </div>\n                                </div>\n                                <hr class="p-0 m-0">\n                            </div>\n                            <div class="overflow-auto" style="max-height:200px;">\n                            '),$.each(JSON.parse(t),function(t,e){e.qty_available;a+='\n                                <a class="item-search-results" data-id="'.concat(e.item_id,'">\n                                    <div class="view overlay  ').concat(0==e.qty_available?"red lighten-4":"",'">\n                                        <div class="row px-3 py-2">\n                                            <div class="col-8 d-flex flex-row">\n                                                <h5 class="my-auto">').concat(e.description,'</h5>\n                                                <small class="my-auto px-2 text-muted">').concat(e.item_no,'</small>\n                                            </div>\n                                            <div class="col-4 d-flex flex-row justify-content-end">\n                                                <strong class="my-auto">Qty: </strong>\n                                                <p class="my-auto px-1 ').concat(0==e.qty_available?"text-danger":"",'">').concat(e.qty_available,'</p>\n                                            </div>\n                                            <div class="mask flex-center ').concat(0==e.qty_available?"rgba-red-strong":"rgba-grey-slight",'"></div>\n                                        </div>\n                                    </div>\n                                </a>\n                                <hr class="p-0 m-0">\n                                ')}),a+="</div>",$("#item-search").empty().html(a),s=!1,$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowCountItem",search:$("#search-item").val()},success:function(t){var e,s;$("#itemSearchRowTotal").empty().html(t),e=t,s=Math.ceil(e/10),$("#itemSearchPageTotal").empty().text(s),$("#itemSearchCurrentPageNum").attr("max",s),$("#itemSearchCurrentPageNum").on("focusout",function(){$("#itemSearchCurrentPageNum").val()<s?o($("#itemSearchCurrentPageNum").val()):o(s)})}}),$(".item-search-results").click(function(){$.ajax({type:"POST",url:"./backend/invoice/viewCustmrItem.php",data:{postType:"searchRowItemAdd",itemID:$(this).data("id")},success:function(t){var a,c,o=!1;$.each(JSON.parse(t),function(t,e){var s;c=e.item_id,0<e.qty_available?(o=!1,e.item_id==$(".item-row").data("id")?(s=$("[data-id="+e.item_id+"]").find(".itemQuantity").val(),$("[data-id="+e.item_id+"]").find(".itemQuantity").val(parseInt(s)+1)):a+='\n                                <tr class="item-row" data-id="'.concat(e.item_id,'">\n                                    <td>\n                                        <button class="btn btn-danger deleteItemBtn py-md-3 px-md-4 p-sm-3">\n                                            <i class="fas fa-trash-alt"></i>\n                                        </button>\n                                    </td>\n                                    <td class="item_no">').concat(e.item_no,'</td>\n                                    <td class="description">').concat(e.description,'</td>\n                                    <td>\n                                        <input type="number" class="form-control itemQuantity" min="1" max="').concat(e.qty_available,'" value="1">\n                                    </td>\n                                    <td>\n                                        <input type="text" class="form-control itemUnit" placeholder="unit">\n                                    </td>\n                                    <td class="selling_price">').concat(e.selling_price1,'</td>\n                                    <td class="unit_cost">').concat(e.unit_cost,'</td>\n                                    <td>\n                                        <input type="number" class="form-control itemDiscount" value="0" min="0" max="100" step="1">\n                                    </td>\n                                    <td class="total_price"></td>\n                                </tr>\n                                ')):o=!0}),0==o&&(0<$("#item-bucket").find(".noResultText").length&&$("#item-bucket").empty(),""!=a&&$("#item-bucket").append(a),$("#item-search").empty().removeClass("border"),$("#search-item").val(""),l(c),i(),n(),$(".itemQuantity").change(function(){$(this).val()>parseInt($(this).attr("max"))&&$(this).val($(this).attr("max")),$(this).val()<parseInt($(this).attr("min"))&&$(this).val($(this).attr("min")),l($(this).closest("tr").data("id")),i(),n()}),$(".itemDiscount").change(function(){$(this).val()>parseInt($(this).attr("max"))&&$(this).val($(this).attr("max")),$(this).val()<parseInt($(this).attr("min"))&&$(this).val($(this).attr("min")),l($(this).closest("tr").data("id")),i(),n()})),$(".deleteItemBtn").click(function(){$(this).closest("tr").remove(),0==$.trim($("#item-bucket").html()).length&&$("#item-bucket").html('\n                    <tr class="noResultText">\n                        <td colspan="7" class="text-center">\n                            <h5>No item added yet</h5>\n                        </td>\n                    </tr>\n                ')})}})}))}})},1e3)):($("#item-search").empty().removeClass("border"),s=!1)}function l(t){var e=$("[data-id='"+t+"']").find(".itemQuantity").val(),s=$("[data-id='"+t+"']").find(".itemDoscount").val(),a=$("[data-id='"+t+"']").find(".selling_price").text();0<s&&(a-=a*(s/100)),$("[data-id='"+t+"']").find(".total_price").text((e*a).toFixed(2))}function n(){var a=0;$.each($(".item-row"),function(t,e){var s=$(".item-row:nth-child("+(t+1)+")").find(".total_price").text();a+=parseFloat(s)}),0<parseFloat($("#total_discount").text())&&(a-=parseFloat($("#total_discount").text())),$("#total_cost").empty().html(a.toFixed(2))}function i(){var o=0;$.each($(".item-row"),function(t,e){var s=$(".item-row:nth-child("+(t+1)+")").find(".selling_price").text(),a=$(".item-row:nth-child("+(t+1)+")").find(".itemQuantity").val(),c=$(".item-row:nth-child("+(t+1)+")").find(".itemDiscount").val();0<c&&(o+=s*(c/100)*a)}),$("#total_discount").empty().html(o.toFixed(2))}function r(){var e;return $.ajax({type:"POST",url:"./backend/customer/customer.php",data:{postType:"countRow"},async:!1,success:function(t){$("#rowTotal").empty().append(t),e=t}}),e}function d(t){var e=Math.ceil(t/10);return $("#pageTotal").empty().text(e),$("#currentPageNum").val()>e&&$("#currentPageNum").val(e),e}function t(){var t;s=r(),a=d(s),t=0!=$("#currentPageNum").val()?$("#currentPageNum").val()>a?a:$("#currentPageNum").val():1,$("#currentPageNum").val(t),$.ajax({type:"POST",url:"./backend/customer/customer.php",data:{postType:"view",pageNum:t},success:function(t){"0 results"==t||"No Result"==t?(u("general"),h("general")):function(t,e){switch(e){case"general":u("general"),$.each(t,function(t,e){t++,$("#generalContent").append('<tr> <th scope="row">'+t+'</th> <td> <button id="edit-'+e.customer_id+'" class="btn btn-warning editBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#editModal"> <i class="fas fa-edit"></i> </button> <button id="delete-'+e.customer_id+'" class="btn btn-danger deleteBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#deleteModal"> <i class="fas fa-trash-alt"></i> </button> </td> <td id=\'customer_id-'+e.customer_id+"'>"+e.customer_id+"</td> <td id='customer_account-"+e.customer_id+"'>"+e.customer_account+"</td> <td id='name-"+e.customer_id+"'>"+e.name+"</td> <td id='reg_num-"+e.customer_id+"'>"+e.reg_num+"</td> <td id='outstanding-"+e.customer_id+"'>"+e.outstanding+"</td> <td id='points-"+e.customer_id+"'>"+e.points+"</td> <td id='status-"+e.customer_id+"'>"+e.status+"</td> <td id='address-"+e.customer_id+"'>"+e.address+"</td> <td id='postcode-"+e.customer_id+"'>"+e.postcode+"</td> <td id='state-"+e.customer_id+"'>"+e.state+"</td> <td id='salutation-"+e.customer_id+"'>"+e.salutation+"</td> <td id='email-"+e.customer_id+"'>"+e.email+"</td> <td id='website-"+e.customer_id+"'>"+e.website+"</td> <td id='biz_nature-"+e.customer_id+"'>"+e.biz_nature+"</td> <td id='salesperson-"+e.customer_id+"'>"+e.salesperson+"</td> <td id='category-"+e.customer_id+"'>"+e.category+"</td> <td id='city-"+e.customer_id+"'>"+e.city+"</td> <td id='country-"+e.customer_id+"'>"+e.country+"</td> <td id='attention-"+e.customer_id+"'>"+e.attention+"</td> <td id='introducer-"+e.customer_id+"'>"+e.introducer+"</td> <td id='reg_date-"+e.customer_id+"'>"+e.reg_date+"</td> <td id='expiry_date-"+e.customer_id+"'>"+e.expiry_date+"</td> <td id='telephone1-"+e.customer_id+"'>"+e.telephone1+"</td> <td id='telephone2-"+e.customer_id+"'>"+e.telephone2+"</td> <td id='fax-"+e.customer_id+"'>"+e.fax+"</td> <td id='handphone-"+e.customer_id+"'>"+e.handphone+"</td> <td id='skype-"+e.customer_id+"'>"+e.skype+"</td> <td id='nric-"+e.customer_id+"'>"+e.nric+"</td> <td id='gender-"+e.customer_id+"'>"+e.gender+"</td> <td id='dob-"+e.customer_id+"'>"+e.dob+"</td> <td id='race-"+e.customer_id+"'>"+e.race+"</td> <td id='religion-"+e.customer_id+"'>"+e.religion+"</td></tr>")}),h("general")}}(t=t.includes("Success")?JSON.parse(t.replace("Success","")):JSON.parse(t),"general")},error:function(){var t,s;t="Failed",s="Unexpected error occur : "+e,$("#failedToModal").modal("show"),$("#failedModalHeadline").empty().append(t),$("#failedModalBody").empty().append(s)}})}function h(t){switch(t){case"general":$("#generalTable").DataTable({searching:!1,paginate:!1,lengthChange:!1,info:!1,scrollX:!0,scrollY:"1000px",scrollCollapse:!0}).columns.adjust();$(".dataTables_length").addClass("bs-select")}}function u(t){switch(t){case"general":$("#general-table").empty().append('<table id="generalTable" class="table table-hover table-bordered table_fullwidth text-center" cellspacing="0" >  <thead class="grey lighten-2  ">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Customer ID</th>  <th scope="col" class="th-lg">Customer Account</th>  <th scope="col" class="th-lg">Name</th>  <th scope="col" class="th-lg">Reg Num</th>  <th scope="col" class="th-lg">Outstanding</th>  <th scope="col" class="th-lg">Points</th>  <th scope="col" class="th-lg">Status</th>  <th scope="col" class="th-lg">Address</th>  <th scope="col" class="th-lg">Postcode</th>  <th scope="col" class="th-lg">State</th>  <th scope="col" class="th-lg">Salutation</th>  <th scope="col" class="th-lg">Email</th>  <th scope="col" class="th-lg">Website</th>  <th scope="col" class="th-lg">Biz Nature</th>  <th scope="col" class="th-lg">Sales Person</th>  <th scope="col" class="th-lg">Category</th>  <th scope="col" class="th-lg">City</th>  <th scope="col" class="th-lg">Country</th>  <th scope="col" class="th-lg">Attention</th>  <th scope="col" class="th-lg">Introducer</th>  <th scope="col" class="th-lg">Reg Date</th>  <th scope="col" class="th-lg">Expire Date</th>  <th scope="col" class="th-lg">Telephone 1</th>  <th scope="col" class="th-lg">Telephone 2</th>  <th scope="col" class="th-lg">Fax</th>  <th scope="col" class="th-lg">Handphone</th>  <th scope="col" class="th-lg">Skype</th>  <th scope="col" class="th-lg">NRIC</th>  <th scope="col" class="th-lg">Gender</th>  <th scope="col" class="th-lg">DOB</th>  <th scope="col" class="th-lg">Race</th>  <th scope="col" class="th-lg">Religion</th>  </tr>  </thead>  <tbody id="generalContent">  </tbody>  <tfoot class="grey lighten-2">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Customer ID</th>  <th scope="col" class="th-lg">Customer Account</th>  <th scope="col" class="th-lg">Name</th>  <th scope="col" class="th-lg">Reg Num</th>  <th scope="col" class="th-lg">Outstanding</th>  <th scope="col" class="th-lg">Points</th>  <th scope="col" class="th-lg">Status</th>  <th scope="col" class="th-lg">Address</th>  <th scope="col" class="th-lg">Postcode</th>  <th scope="col" class="th-lg">State</th>  <th scope="col" class="th-lg">Salutation</th>  <th scope="col" class="th-lg">Email</th>  <th scope="col" class="th-lg">Website</th>  <th scope="col" class="th-lg">Biz Nature</th>  <th scope="col" class="th-lg">Sales Person</th>  <th scope="col" class="th-lg">Category</th>  <th scope="col" class="th-lg">City</th>  <th scope="col" class="th-lg">Country</th>  <th scope="col" class="th-lg">Attention</th>  <th scope="col" class="th-lg">Introducer</th>  <th scope="col" class="th-lg">Reg Date</th>  <th scope="col" class="th-lg">Expire Date</th>  <th scope="col" class="th-lg">Telephone 1</th>  <th scope="col" class="th-lg">Telephone 2</th>  <th scope="col" class="th-lg">Fax</th>  <th scope="col" class="th-lg">Handphone</th>  <th scope="col" class="th-lg">Skype</th>  <th scope="col" class="th-lg">NRIC</th>  <th scope="col" class="th-lg">Gender</th>  <th scope="col" class="th-lg">DOB</th>  <th scope="col" class="th-lg">Race</th>  <th scope="col" class="th-lg">Religion</th>  </tr>  </tfoot>  </table>')}}t(),$("#currentPageNum").focusout(function(){(""!=$("#searchRow").val()?searchTable:t)()}),$("#search-customer_name").on("keyup",function(){c(1)}),$("#search-customer_id").on("keyup",function(){c(1)}),$("#search-item").on("keyup",function(){o(1)}),$("#addInvoiceSubmitBtn").click(function(){var t,e,s,a,c,o,l,n,i,r,d,h,u;i=[],r=[],d=[],h=[],u=[],0<$("#item-bucket").find(".noResultText").length?console.log("true"):(t=$("#search-customer_name").val(),e=$("#search-customer_id").val(),s=$("#invoice_number").val(),a=$("#doc_no").val(),c=$("#invoice_date").val(),o=$("#due_date").val(),l=$("#invoice_remark").val(),n=$("#total_cost").text(),$.each($(".item-row"),function(t,e){i.push($(".item-row:nth-child("+(t+1)+")").find(".item_no").text()),r.push($(".item-row:nth-child("+(t+1)+")").find(".description").text()),d.push($(".item-row:nth-child("+(t+1)+")").find(".selling_price").text()),h.push($(".item-row:nth-child("+(t+1)+")").find(".itemQuantity").val()),u.push($(".item-row:nth-child("+(t+1)+")").find(".total_price").text())}),$.ajax({type:"POST",url:"./backend/invoice/invoice.php",data:{postType:"add",in_name:t,in_account:e,doc_no:a,invoice_num:s,invoice_date:c,due_date:o,invoice_remark:l,total_amount:n,item_no:i,description:r,price:d,quantity:h,base_cost:u},success:function(t){console.log(t)}}))})});