"use strict";$(document).ready(function(){console.log("sales payment page script");var e,c=t(),o=d(c),s=!1,a=!1;function n(a){var e,t;""!=$("#salespayment-search-salesorder").val()?(clearTimeout(e),e=setTimeout(function(){$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"salesorderSearch",searchSalesOrder:$("#salespayment-search-salesorder").val(),pageNum:a},success:function(e){"No result"==e?1==s&&($("#salespayment-salesorder-search").empty().html('\n                                <div class="row">\n                                    <div class="col-6">\n                                        <h5>'.concat(e,'</h5>\n                                    </div>\n                                    <div class="col-6 text-right">\n                                        <a class="btn btn-primary" href="./itemMaintenance.php">Go add new item</a>\n                                    </div>\n                                </div>\n                                ')),s=!1):""==e?($("#salespayment-salesorder-search").empty().removeClass("border"),s=!1):(t='\n                            <div class="sticky-top bg-white">\n                                <div class="row px-3 py-2 ">\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <p class="my-auto">Search Result: <span class="font-weight-bold" id="itemSearchRowTotal"></span></p>\n                                    </div>\n                                    <div class=" col-6 py-2 py-md-0">\n                                        <div class="d-flex flex-row justify-content-end">\n                                            <p class="my-auto">Page : </p>\n                                            <input type="number" id="salespaymentSearchCurrentPageNum" class="form-control w-25 mx-2 my-auto px-2 pageInput" min="1" value="'.concat(a,'">\n                                            <p class="my-auto"> of <span id="salespaymentSearchPageTotal"></span></p>\n                                        </div>\n                                    </div>\n                                </div>\n                                <hr class="p-0 m-0">\n                            </div>\n                            <div class="overflow-auto" style="max-height:200px;">\n                            '),$.each(JSON.parse(e),function(e,a){t+='\n                                <a class="salespayment-search-results" data-id="'.concat(a.sale_id,'">\n                                    <div class="view overlay  ').concat("Unpaid"==a.payment_status?"":"green lighten-4",'">\n                                        <div class="row px-3 py-2">\n                                            <div class="col-8 d-flex flex-row">\n                                                <h5 class="my-auto">').concat(a.sale_id,'</h5>\n                                                <small class="my-auto px-2 text-muted">').concat(a.customer_name,'</small>\n                                            </div>\n                                            <div class="col-4 d-flex flex-row justify-content-end">\n                                                <strong class="my-auto">Status</strong>\n                                                <p class="my-auto px-1 ').concat("Unpaid"==a.payment_status?"":"text-success",'">').concat(a.payment_status,'</p>\n                                            </div>\n                                            <div class="mask flex-center ').concat("Unpaid"==a.payment_status?"rgba-grey-slight":"rgba-green-strong",'"></div>\n                                        </div>\n                                    </div>\n                                </a>\n                                <hr class="p-0 m-0">\n                                '),t+="</div>",$("#salespayment-salesorder-search").empty().html(t),s=!1,$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"salesorderCountRow",searchSalesOrder:$("#salespayment-search-salesorder").val()},success:function(e){var a,t;console.log(e),$("#salespaymentSearchPageTotal").empty().html(e),a=e,t=Math.ceil(a/10),$("#salespaymentSearchPageTotal").empty().text(t),$("#salespaymentSearchCurrentPageNum").attr("max",t),$("#salespaymentSearchCurrentPageNum").on("input",function(){""==$("#salespaymentSearchCurrentPageNum").val()?console.log("empty item search"):$("#salespaymentSearchCurrentPageNum").val()<t?n($("#salespaymentSearchCurrentPageNum").val()):n(t)})},error:function(e){r("Failed","Unexpected error occur : "+e)}}),$(".salespayment-search-results").click(function(){$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"searchSalesOrderSelect",saleID:$(this).data("id")},success:function(e){var t="",s=0;$.each(JSON.parse(e),function(e,a){a.sale_id!=$(".salespayment-row").data("id")?(s+=parseFloat(a.sale_total_amount),t+='\n                            <tr class="salespayment-row" data-id="'.concat(a.sale_id,'">\n                                <td>\n                                    <button class="btn btn-danger deleteSalesOrderBtn py-md-3 px-md-4 p-sm-3">\n                                        <i class="fas fa-trash-alt"></i>\n                                    </button>\n                                </td>\n                                <td class="sale_id">').concat(a.sale_id,'</td>\n                                <td class="customer_name">').concat(a.customer_name,'</td>\n                                <td class="sale_salesperson">').concat(a.sale_salesperson,'</td>\n                                <td class="sale_date">').concat(a.sale_date,'</td>\n                                <td class="sale_subtotal">').concat(a.sale_subtotal,'</td>\n                                <td class="sale_discount_header">').concat(a.sale_discount_header,'</td>\n                                <td class="sale_total_amount">').concat(a.sale_total_amount,"</td>\n                            </tr>\n                        ")):s+=parseFloat(a.sale_total_amount)}),0<$("#salespayment-salesorder-bucket").find(".salespayment-noResultText").length&&($("#salespayment-salesorder-bucket").empty(),$("#salespayment-search-salesorder").attr("readonly",!0)),$("#salespayment-salesorder-search").empty().removeClass("border"),$("#salespayment-search-salesorder").val(""),""!=t&&$("#salespayment-salesorder-bucket").append(t),$(".deleteSalesOrderBtn").click(function(){$(this).closest("tr").remove();var e=parseFloat($(this).parent().parent().find(".sale_total_amount").text()),a=parseFloat($("#salespayment_totalCharge").text());$("#salespayment-search-salesorder").attr("readonly",!1),$("#salespayment-total_cost, #salespayment_totalCharge").empty().text((a-e).toFixed(2)),0==$.trim($("#salespayment-salesorder-bucket").html()).length&&$("#salespayment-salesorder-bucket").html('\n                                <tr class="salespayment-noResultText">\n                                    <td colspan="9" class="text-center">\n                                        <h5>No sales order added yet</h5>\n                                    </td>\n                                </tr>\n                            ')}),$("#salespayment_totalCharge, #salespayment-total_cost").empty().text(s.toFixed(2));var a=parseFloat($("#salespayment_amountPaid").text()),n=parseFloat($("#salespayment_totalCharge").text());n<a?$("#salespayment_exchange").empty().text((a-n).toFixed(2)):$("#salespayment_exchange").empty().text("0.00"),$("#salespayment-amount_apply").change(function(){var e=parseFloat($(this).val()).toFixed(2);$(this).val(e),$("#salespayment_amountPaid").empty().text(e);var a=parseFloat($("#salespayment_amountPaid").text()),t=parseFloat($("#salespayment_totalCharge").text());t<a?$("#salespayment_exchange").empty().text((a-t).toFixed(2)):$("#salespayment_exchange").empty().text("0.00")})},error:function(e){r("Failed","Unexpected error occur : "+e)}})}),$("#salespaymentSearchCurrentPageNum").focusout(function(){salespaymentsearchResults(parseInt($(this).val()))})}))},error:function(e){r("Failed","Unexpected error occur : "+e)}})},1e3)):($("#salespayment-salesorder-search").empty().removeClass("border"),s=!1)}function r(e,a){$("#failedToModal").modal("show"),$("#failedModalHeadline").empty().append(e),$("#failedModalBody").empty().append(a)}function t(){var a;return $.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"countRow"},async:!1,success:function(e){$("#salespayment-rowTotal").empty().append(e),a=e},error:function(e){r("Failed","Unexpected error occur : "+e)}}),a}function d(e){var a=Math.ceil(e/20);return $("#salespayment-pageTotal").empty().text(a),$("#salespayment-currentPageNum").val()>a&&$("#salespayment-currentPageNum").val(a),a}function p(){var e;c=t(),o=d(c),e=0!=$("#salespayment-currentPageNum").val()?$("#salespayment-currentPageNum").val()>o?o:$("#salespayment-currentPageNum").val():1,$("#salespayment-currentPageNum").val(e),$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"viewSalePayment",pageNum:e},success:function(e){console.log(e),"0 results"==e||"No Result"==e?(m("salespayment"),l("salespayment")):function(e,a){switch(a){case"salespayment":m("salespayment"),$.each(e,function(e,a){$("#salespaymentContent").append('\n                        <tr class="salespayment-row" data-salespayment-id="'.concat(a.sale_id,'">\n                            <th>').concat(++e,'</th>\n                            <td>\n                                <button class="btn btn-warning editSalesPaymentBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#editSalesOrderModal">\n                                    <i class="fas fa-edit"></i>\n                                </button>\n                                <button class="btn btn-secondary printSalesPaymentBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#deleteSalesOrderModal">\n                                    <i class="fas fa-print"></i>\n                                </button>\n                            </td>\n                            <td class="sale_payment_id">').concat(a.sale_payment_id,'</td>\n                            <td class="sale_id_header">').concat(a.sale_id_header,'</td>\n                            <td class="sale_payment_date">').concat(a.sale_payment_date,'</td>\n                            <td class="sale_payment_time">').concat(a.sale_payment_time,'</td>\n                            <td class="payment_method">').concat(a.payment_method,'</td>\n                            <td class="customer_name">').concat(a.customer_name,'</td>\n                            <td class="sale_amount">').concat(a.sale_amount,'</td>\n                            <td class="sale_payment">').concat(a.sale_payment,'</td>\n                            <td class="reference">').concat(a.reference,"</td>\n                        </tr>\n                    "))}),l("salespayment")}}(JSON.parse(e),"salespayment")},failed:function(e){r("Failed","Unexpected error occur : "+e)}})}function l(e){switch(e){case"salespayment":$("#salespaymentTable").DataTable({searching:!1,paginate:!1,lengthChange:!1,info:!1,scrollX:!0,scrollY:"1000px",scrollCollapse:!0}).columns.adjust();$(".dataTables_length").addClass("bs-select")}}function m(e){switch(e){case"salespayment":$("#salespayment-table").empty().append('<table id="salespaymentTable" class="table table-hover table-bordered table_fullwidth text-center" cellspacing="0" >  <thead class="grey lighten-2  ">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Sale Payment ID</th>  <th scope="col" class="th-lg">Sale Header ID</th>  <th scope="col" class="th-lg">Payment Date</th>  <th scope="col" class="th-lg">Payment Time</th>  <th scope="col" class="th-lg">Payment Method</th>  <th scope="col" class="th-lg">Customer Name</th>  <th scope="col" class="th-lg">Sale Amount</th>  <th scope="col" class="th-lg">Sale Payment</th>  <th scope="col" class="th-lg">Reference</th>  </tr>  </thead>  <tbody id="salespaymentContent">  </tbody>  <tfoot class="grey lighten-2">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Sale Payment ID</th>  <th scope="col" class="th-lg">Sale Header ID</th>  <th scope="col" class="th-lg">Payment Date</th>  <th scope="col" class="th-lg">Payment Time</th>  <th scope="col" class="th-lg">Payment Method</th>  <th scope="col" class="th-lg">Customer Name</th>  <th scope="col" class="th-lg">Sale Amount</th>  <th scope="col" class="th-lg">Sale Payment</th>  <th scope="col" class="th-lg">Reference</th>  </tr>  </tfoot>  </table>')}}p(),$("#salespayment-currentPageNum").focusout(function(){p()}),$("#salespayment-search-salesorder").on("keyup",function(){clearTimeout(e),s||($("#salespayment-salesorder-search").empty().addClass("border").html('\n                <div class="d-flex justify-content-center">\n                    <div class="spinner-border" role="status">\n                        <span class="sr-only">Loading...</span>\n                    </div>\n                </div>\n                '),s=!0),$(this).val()?e=setTimeout(function(){n(1)},1e3):($("#salespayment-salesorder-search").empty().removeClass("border"),s=!1)}),$("#update-salespayment-search-salesorder").on("keyup",function(){clearTimeout(void 0),a||($("#update-salespayment-salesorder-search").empty().addClass("border").html('\n                    <div class="d-flex justify-content-center">\n                        <div class="spinner-border" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                    </div>\n                    '),a=!0),$(this).val()?timeUpdater=setTimeout(function(){},1e3):($("#update-salespayment-salesorder-search").empty().removeClass("border"),a=!1)}),$("#addSalesPaymentModalBtn").click(function(){}),$("#addSalesPaymentSubmitBtn").click(function(){var e,a,t,s,n,l;parseFloat($("#salespayment-amount_apply").text())<=0?r("Failed","Current payment amount is 0"):(e=$(".salespayment-row").find(".customer_name").text(),a=$(".salespayment-row").data("id"),t=$("#salespayment-payment_mode").val(),s=$("#salespayment_totalCharge").text(),n=$("#salespayment_amountPaid").text(),l=$("#salespayment-reference").val(),$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"addSalePayment",customer_name:e,sale_id:a,payment_method:t,sale_amount:s,sale_payment:n,reference:l},success:function(e){switch(e){case"Some input field is not set.":$("#addSalesPaymentModal").modal("hide"),r("Failed",e);break;case"success add payment":$("#addSalesPaymentModal").modal("hide"),$("#successModalHeadline").empty().append("Success"),$("#successModalBody").empty().append("Sale Payment is successfully added"),$("#successToModal").modal("show"),$("#salespayment-table").empty(),$("#salespayment-currentPageNum").val(1),o=d(c),p()}}}))}),$("#editSalesPaymentSubmitBtn").click(function(){parseFloat($("#update-salespayment-amount_apply").text())<=0&&r("Failed","Current payment amount is 0")}),$("#printSalesPaymentModal").click(function(){}),$("#salespayment-amount_apply").change(function(){var e=parseFloat($(this).val()).toFixed(2);$(this).val(e),$("#salespayment_amountPaid").empty().text(e)})});