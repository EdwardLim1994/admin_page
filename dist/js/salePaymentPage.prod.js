"use strict";$(document).ready(function(){var e,t=c(),a=o(t),s=!1,n=!1;function l(e,t){$("#failedToModal").modal("show"),$("#failedModalHeadline").empty().append(e),$("#failedModalBody").empty().append(t)}function c(){var t;return $.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"countRow"},async:!1,success:function(e){$("#salespayment-rowTotal").empty().append(e),t=e},error:function(e){l("Failed","Unexpected error occur : "+e)}}),t}function o(e){var t=Math.ceil(e/20);return $("#salespayment-pageTotal").empty().text(t),$("#salespayment-currentPageNum").val()>t&&$("#salespayment-currentPageNum").val(t),t}function d(){var e;t=c(),a=o(t),e=0!=$("#salespayment-currentPageNum").val()?$("#salespayment-currentPageNum").val()>a?a:$("#salespayment-currentPageNum").val():1,$("#salespayment-currentPageNum").val(e),$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"viewSalePayment",pageNum:e},success:function(e){"0 results"==e||"No Result"==e?(r("salespayment"),p("salespayment")):(function(e,t){switch(t){case"salespayment":r("salespayment"),$.each(e,function(e,t){$("#salespaymentContent").append('\n                        <tr class="salespayment-row" data-salespayment-id="'.concat(t.sale_payment_id,'">\n                            <th>').concat(++e,'</th>\n                            <td>\n                                <button title="View Payment" class="btn btn-warning editSalesPaymentBtn py-md-3 px-md-4 p-sm-3" data-toggle="modal" data-target="#editSalesPaymentModal">\n                                    <i class="fas fa-receipt"></i>\n                                </button>\n                                <button title="Print Payment" class="btn btn-secondary printSalesPaymentBtn py-md-3 px-md-4 p-sm-3"  data-toggle="modal" data-target="#printSalesPaymentModal">\n                                    <i class="fas fa-print"></i>\n                                </button>\n                            </td>\n                            <td class="sale_payment_id">').concat(t.sale_payment_id,'</td>\n                            <td class="sale_id_header">').concat(t.sale_id_header,'</td>\n                            <td class="sale_payment_date">').concat(t.sale_payment_date,'</td>\n                            <td class="sale_payment_time">').concat(t.sale_payment_time,'</td>\n                            <td class="payment_method">').concat(t.payment_method,'</td>\n                            <td class="customer_name">').concat(t.customer_name,'</td>\n                            <td class="sale_amount">').concat(t.sale_amount,'</td>\n                            <td class="sale_payment">').concat(t.sale_payment,'</td>\n                            <td class="reference">').concat(t.reference,"</td>\n                        </tr>\n                    "))}),p("salespayment")}}(JSON.parse(e),"salespayment"),$(".editSalesPaymentBtn").click(function(){var e=$(this).parent().parent(),t=e.find(".reference").text(),a=e.find(".payment_method").text(),s=e.find(".sale_payment").text(),n=e.find(".sale_id_header").text();$("#update-salespayment-amount_apply").val(s),$("#update-salespayment-payment_mode").val(a),$("#update-salespayment-reference").val(t),$("#update-salespayment_amountPaid").empty().text(s),$("#update-salespayment_id").val(e.data("salespayment-id")),$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"searchSalesOrderSelect",saleID:n},success:function(e){var a="",s=0;$.each(JSON.parse(e),function(e,t){t.sale_id!=$(".salespayment-row").data("id")?(s+=parseFloat(t.sale_total_amount),a+='\n                                            <tr class="update-salespayment-row" data-id="'.concat(t.sale_id,'">\n                                                <td>\n                                                    <button title="View Sales Order Detail" class="btn btn-secondary viewSalesOrderBtn py-md-3 px-md-4 p-sm-3">\n                                                        <i class="fas fa-file-invoice"></i>\n                                                    </button>\n                                                </td>\n                                                <td class="sale_id">').concat(t.sale_id,'</td>\n                                                <td class="customer_name">').concat(t.customer_name,'</td>\n                                                <td class="sale_salesperson">').concat(t.sale_salesperson,'</td>\n                                                <td class="sale_date">').concat(t.sale_date,'</td>\n                                                <td class="sale_subtotal">').concat(t.sale_subtotal,'</td>\n                                                <td class="sale_discount_header">').concat(t.sale_discount_header,'</td>\n                                                <td class="sale_total_amount">').concat(t.sale_total_amount,"</td>\n                                            </tr>\n                                        ")):s+=parseFloat(t.sale_total_amount)}),0<$("#update-salespayment-salesorder-bucket").find(".update-salespayment-noResultText").length&&($("#update-salespayment-salesorder-bucket").empty(),$("#update-salespayment-search-salesorder").attr("readonly",!0)),$("#update-salespayment-salesorder-search").empty().removeClass("border"),$("#update-salespayment-search-salesorder").val(""),""!=a&&$("#update-salespayment-salesorder-bucket").empty().html(a),$("#update-salespayment_totalCharge, #update-salespayment-total_cost").empty().text(s.toFixed(2)),$(".viewSalesOrderBtn").click(function(){$.ajax({type:"POST",url:"./backend/sale/salePayment.php",data:{postType:"viewSalePaymentDetail",sale_id:$(this).parent().parent().data("id")},success:function(e){var t=JSON.parse(e),a="",s=0,n=0;$.each(t[0],function(e,t){$("#salepaymentdetail-sale_id").empty().text(t.sale_id),$("#salepaymentdetail-customer_account").empty().text(t.customer_account),$("#salepaymentdetail-customer_name").empty().text(t.customer_name),$("#salepaymentdetail-sale_salesperson").empty().text(t.sale_salesperson),$("#salepaymentdetail-sale_subtotal").empty().text(t.sale_subtotal),$("#salepaymentdetail-sale_discount_header").empty().text(100*parseFloat(t.sale_discount_header)),$("#salepaymentdetail-sale_total_amount").empty().text(t.sale_total_amount)}),$.each(t[1],function(e,t){"No Result"==t?l("Failed","Could not find any sale order"):(n+=parseFloat(t.amount)*(parseFloat(t.discount)/100),s+=parseFloat(t.price),a+="\n                            <tr>\n                                <td>".concat(t.item_no,"</td>\n                                <td>").concat(t.description,"</td>\n                                <td>").concat(t.qty,"</td>\n                                <td>").concat(t.uom,"</td>\n                                <td>").concat(t.amount,"</td>\n                                <td>").concat(parseInt(t.discount),"</td>\n                                <td>").concat(t.price,"</td>\n                            </tr>\n                            "))}),$("#salespaymentdetail-item-bucket").empty().html(a),$("#salepaymentdetail-total_discount").empty().text(n.toFixed(2)),$("#salepaymentdetail-total_cost").empty().text(s.toFixed(2)),$("#viewSalesOrderDetailModal").modal("show")},error:function(e){l("Failed","Unexpected error occur : "+e)}})})},error:function(e){l("Failed","Unexpected error occur : "+e)}})}),$(".printSalesPaymentBtn").click(function(){$("#print_salepayment_id").val($(this).parent().parent().data("salespayment-id"))}))},failed:function(e){l("Failed","Unexpected error occur : "+e)}})}function p(e){switch(e){case"salespayment":$("#salespaymentTable").DataTable({searching:!1,paginate:!1,lengthChange:!1,info:!1,scrollX:!0,scrollY:"1000px",scrollCollapse:!0}).columns.adjust();$(".dataTables_length").addClass("bs-select")}}function r(e){switch(e){case"salespayment":$("#salespayment-table").empty().append('<table id="salespaymentTable" class="table table-hover table-bordered table_fullwidth text-center" cellspacing="0" >  <thead class="grey lighten-2  ">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Sale Payment ID</th>  <th scope="col" class="th-lg">Sale Header ID</th>  <th scope="col" class="th-lg">Payment Date</th>  <th scope="col" class="th-lg">Payment Time</th>  <th scope="col" class="th-lg">Payment Method</th>  <th scope="col" class="th-lg">Customer Name</th>  <th scope="col" class="th-lg">Sale Amount</th>  <th scope="col" class="th-lg">Sale Payment</th>  <th scope="col" class="th-lg">Reference</th>  </tr>  </thead>  <tbody id="salespaymentContent">  </tbody>  <tfoot class="grey lighten-2">  <tr>  <th scope="col">#</th>  <th scope="col" class="text-center th-lg">Action</th>  <th scope="col" class="th-lg">Sale Payment ID</th>  <th scope="col" class="th-lg">Sale Header ID</th>  <th scope="col" class="th-lg">Payment Date</th>  <th scope="col" class="th-lg">Payment Time</th>  <th scope="col" class="th-lg">Payment Method</th>  <th scope="col" class="th-lg">Customer Name</th>  <th scope="col" class="th-lg">Sale Amount</th>  <th scope="col" class="th-lg">Sale Payment</th>  <th scope="col" class="th-lg">Reference</th>  </tr>  </tfoot>  </table>')}}d(),$("#salespayment-currentPageNum").focusout(function(){d()}),$("#salespayment-search-salesorder").on("keyup",function(){clearTimeout(e),s||($("#salespayment-salesorder-search").empty().addClass("border").html('\n                <div class="d-flex justify-content-center">\n                    <div class="spinner-border" role="status">\n                        <span class="sr-only">Loading...</span>\n                    </div>\n                </div>\n                '),s=!0),$(this).val()?e=setTimeout(function(){salespaymentSearchResults(1)},1e3):($("#salespayment-salesorder-search").empty().removeClass("border"),s=!1)}),$("#update-salespayment-search-salesorder").on("keyup",function(){clearTimeout(void 0),n||($("#update-salespayment-salesorder-search").empty().addClass("border").html('\n                    <div class="d-flex justify-content-center">\n                        <div class="spinner-border" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                    </div>\n                    '),n=!0),$(this).val()?timeUpdater=setTimeout(function(){updateSalespaymentSearchResults(1)},1e3):($("#update-salespayment-salesorder-search").empty().removeClass("border"),n=!1)})});